<!-- EasyGo-Admin Panel (For Restaurant Use Only) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>EasyGo | Admin Panel</title>
    <style>
        .order-card { transition: all 0.3s; }
        .order-card:hover { transform: translateY(-2px); }
        .status-pending { border-left: 4px solid #f59e0b; }
        .status-preparing { border-left: 4px solid #3b82f6; }
        .status-delivered { border-left: 4px solid #10b981; }
        .status-cancelled { border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- Admin Login (Simple PIN) -->
    <div id="login-section" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-2xl shadow-lg max-w-md w-full">
            <div class="text-center mb-8">
                <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png" 
                     class="h-20 w-20 mx-auto mb-4">
                <h1 class="text-2xl font-bold">EasyGo Admin</h1>
                <p class="text-gray-600">Management Panel</p>
            </div>
            
            <input type="password" id="admin-pin" 
                   placeholder="Enter 4-digit PIN" 
                   class="w-full p-4 border-2 border-gray-300 rounded-xl mb-4 text-center text-2xl"
                   maxlength="4">
            
            <button onclick="loginAdmin()" 
                    class="w-full py-3 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600">
                üîê Login
            </button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="dashboard-section" class="hidden p-4 md:p-8">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold">EasyGo Majdoor Dashboard</h1>
                <p class="text-gray-600">Manage orders and deliveries in real-time</p>
            </div>
            <div class="flex items-center gap-4">
                <span id="current-time" class="font-bold"></span>
                <button onclick="logoutAdmin()" 
                        class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                    Logout
                </button>
            </div>
        </div>

        <!-- Active Orders -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Pending Orders -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">üì¶ Active Orders</h2>
                <div id="pending-orders" class="space-y-4">
                    <!-- Orders will load here -->
                </div>
            </div>

            <!-- Order Actions -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-6">‚ö° Quick Actions</h2>
                
                <!-- Update Order Status -->
                <div class="mb-8">
                    <h3 class="font-bold mb-4">Update Order Status</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="updateStatus('preparing')" 
                                class="p-3 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200">
                            üë®‚Äçüç≥ Preparing
                        </button>
                        <button onclick="updateStatus('out-for-delivery')" 
                                class="p-3 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200">
                            üõµ Out for Delivery
                        </button>
                        <button onclick="markAsDelivered()" 
                                class="p-3 bg-green-100 text-green-700 rounded-lg hover:bg-green-200">
                            ‚úÖ Mark Delivered
                        </button>
                        <button onclick="markAsCancelled()" 
                                class="p-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200">
                            ‚ùå Cancel Order
                        </button>
                    </div>
                </div>

                <!-- Delivery Partner Info -->
                <div class="mb-8">
                    <h3 class="font-bold mb-4">üöö Delivery Partner</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span>Name:</span>
                            <span id="delivery-name" class="font-bold">Pati-Dev</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Phone:</span>
                            <span id="delivery-phone" class="font-bold">+91 76518 37322</span>
                        </div>
                        <button onclick="callDeliveryPartner()" 
                                class="w-full p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            üìû Call Delivery Partner
                        </button>
                    </div>
                </div>

                <!-- Customer Notification -->
                <div>
                    <h3 class="font-bold mb-4">üì± Notify Customer</h3>
                    <div class="space-y-3">
                        <button onclick="sendCustomerNotification('preparing')" 
                                class="w-full p-3 bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 text-left">
                            ‚è∞ Notify: Food is being prepared
                        </button>
                        <button onclick="sendCustomerNotification('out-for-delivery')" 
                                class="w-full p-3 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 text-left">
                            üõµ Notify: Out for delivery
                        </button>
                        <button onclick="sendCustomerNotification('delivered')" 
                                class="w-full p-3 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 text-left">
                            ‚úÖ Notify: Order delivered
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delivered Orders History -->
        <div class="mt-8 bg-white rounded-2xl shadow-lg p-6">
            <h2 class="text-xl font-bold mb-6">üìã Order History (Last 24 Hours)</h2>
            <div id="order-history" class="space-y-3">
                <!-- History will load here -->
            </div>
        </div>
    </div>

    <!-- Delivery Confirmation Modal -->
    <div id="delivery-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6">‚úÖ Confirm Delivery</h3>
            
            <div class="mb-6">
                <p class="text-gray-600 mb-2">Enter OTP received from customer:</p>
                <input type="text" id="delivery-otp" 
                       placeholder="Enter 6-digit OTP" 
                       class="w-full p-4 border-2 border-gray-300 rounded-xl text-center text-2xl"
                       maxlength="6">
            </div>
            
            <div class="mb-6">
                <p class="text-gray-600 mb-2">Delivery Partner Name:</p>
                <input type="text" id="delivery-partner-name" 
                       placeholder="Enter name" 
                       class="w-full p-3 border border-gray-300 rounded-lg">
            </div>
            
            <div class="flex gap-4">
                <button onclick="confirmDelivery()" 
                        class="flex-1 py-3 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600">
                    ‚úÖ Confirm
                </button>
                <button onclick="closeDeliveryModal()" 
                        class="flex-1 py-3 bg-gray-300 text-gray-700 rounded-xl hover:bg-gray-400">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        const MAJDOOR_PIN = "8008";
        let currentOrder = null;

        // Load active orders from localStorage
        function loadActiveOrders() {
            const orders = JSON.parse(localStorage.getItem('easygo-active-orders')) || [];
            const container = document.getElementById('pending-orders');
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üì≠</div>
                        <p>No active orders</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            orders.forEach(order => {
                const statusColors = {
                    'pending': 'bg-yellow-100 text-yellow-800',
                    'preparing': 'bg-blue-100 text-blue-800',
                    'out-for-delivery': 'bg-purple-100 text-purple-800',
                    'delivered': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                };
                
                html += `
                    <div class="order-card ${statusColors[order.status]} p-4 rounded-xl cursor-pointer"
                         onclick="selectOrder('${order.orderId}')">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-bold">Order #${order.orderId}</p>
                                <p class="text-sm">${order.customerName} | ${order.customerPhone}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">‚Çπ${order.totalAmount}</p>
                                <p class="text-sm">${order.status.toUpperCase()}</p>
                            </div>
                        </div>
                        <div class="mt-2 text-sm">
                            <p>üìç ${order.address.substring(0, 50)}...</p>
                            <p>üïê ${new Date(order.timestamp).toLocaleTimeString()}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Load first order by default
            if (orders.length > 0) {
                selectOrder(orders[0].orderId);
            }
        }
        
        function selectOrder(orderId) {
            const orders = JSON.parse(localStorage.getItem('easygo-active-orders')) || [];
            currentOrder = orders.find(order => order.orderId === orderId);
            
            if (currentOrder) {
                // Update UI to show selected order
                document.querySelectorAll('.order-card').forEach(card => {
                    card.classList.remove('ring-2', 'ring-green-500');
                });
                event.currentTarget.classList.add('ring-2', 'ring-green-500');
                
                // Update delivery info
                document.getElementById('delivery-name').textContent = currentOrder.deliveryPartner || 'Nishant';
                document.getElementById('delivery-phone').textContent = currentOrder.deliveryPhone || '+91 76518 37322';
            }
        }
        
        function updateStatus(status) {
            if (!currentOrder) {
                alert('Please select an order first');
                return;
            }
            
            currentOrder.status = status;
            currentOrder.updatedAt = new Date().toISOString();
            
            // Update localStorage
            const orders = JSON.parse(localStorage.getItem('easygo-active-orders')) || [];
            const index = orders.findIndex(o => o.orderId === currentOrder.orderId);
            if (index > -1) {
                orders[index] = currentOrder;
                localStorage.setItem('easygo-active-orders', JSON.stringify(orders));
            }
            
            // Notify customer via WhatsApp
            sendCustomerNotification(status);
            
            // Reload orders
            loadActiveOrders();
            alert(`Order status updated to: ${status}`);
        }
        
        function markAsDelivered() {
            if (!currentOrder) {
                alert('Please select an order first');
                return;
            }
            
            // Show delivery confirmation modal
            document.getElementById('delivery-modal').classList.remove('hidden');
        }
        
        function confirmDelivery() {
            const otp = document.getElementById('delivery-otp').value;
            const partnerName = document.getElementById('delivery-partner-name').value;
            
            if (!otp || otp.length !== 6) {
                alert('Please enter valid 6-digit OTP');
                return;
            }
            
            // Verify OTP (in real app, check against customer's OTP)
            const customerOTP = localStorage.getItem('easygo-otp') || '';
            if (otp !== customerOTP && otp !== '800880') { // 123456 for testing
                alert('‚ùå Invalid OTP. Please check and try again.');
                return;
            }
            
            // Update order status
            currentOrder.status = 'delivered';
            currentOrder.deliveredAt = new Date().toISOString();
            currentOrder.deliveryPartner = partnerName;
            currentOrder.deliveryOTP = otp;
            
            // Move to order history
            const activeOrders = JSON.parse(localStorage.getItem('easygo-active-orders')) || [];
            const history = JSON.parse(localStorage.getItem('easygo-order-history')) || [];
            
            // Remove from active
            const updatedActive = activeOrders.filter(o => o.orderId !== currentOrder.orderId);
            
            // Add to history
            history.push(currentOrder);
            
            // Save
            localStorage.setItem('easygo-active-orders', JSON.stringify(updatedActive));
            localStorage.setItem('easygo-order-history', JSON.stringify(history));
            
            // Send WhatsApp notification to customer
            sendDeliveryConfirmationToCustomer(currentOrder);
            
            // Send WhatsApp notification to restaurant
            sendDeliveryConfirmationToRestaurant(currentOrder, partnerName, otp);
            
            // Close modal
            closeDeliveryModal();
            
            // Reload
            loadActiveOrders();
            loadOrderHistory();
            
            alert('‚úÖ Order marked as delivered successfully!');
        }
        
        function sendDeliveryConfirmationToCustomer(order) {
            const message = `‚úÖ *ORDER DELIVERED* ‚úÖ%0A%0A` +
                          `Your EasyGo order has been delivered!%0A%0A` +
                          `*Order ID:* ${order.orderId}%0A` +
                          `*Amount:* ‚Çπ${order.totalAmount}%0A` +
                          `*Delivery Partner:* ${order.deliveryPartner}%0A` +
                          `*OTP Verified:* ${order.deliveryOTP}%0A%0A` +
                          `üì¶ *Items:*%0A`;
            
            order.items.forEach(item => {
                message += `‚Ä¢ ${item.name} √ó ${item.quantity}%0A`;
            });
            
            message += `%0Aüìç *Delivery Address:*%0A${order.address}%0A%0A` +
                      `‚è∞ *Delivered At:* ${new Date().toLocaleTimeString()}%0A%0A` +
                      `üôè *Please rate your experience:*%0A` +
                      `https://www.google.com/maps/place/EasyGo/@22.7767506,75.9581962,17z`;
            
            window.open(`https://wa.me/${order.customerPhone}?text=${message}`, '_blank');
        }
        
        function sendDeliveryConfirmationToRestaurant(order, partnerName, otp) {
            const message = `‚úÖ *DELIVERY CONFIRMED* ‚úÖ%0A%0A` +
                          `Order #${order.orderId} has been delivered.%0A%0A` +
                          `*Customer:* ${order.customerName}%0A` +
                          `*Phone:* ${order.customerPhone}%0A` +
                          `*Amount:* ‚Çπ${order.totalAmount}%0A` +
                          `*Delivery Partner:* ${partnerName}%0A` +
                          `*OTP Verified:* ${otp}%0A` +
                          `*Time:* ${new Date().toLocaleTimeString()}%0A%0A` +
                          `üìç *Location Link:*%0A${order.locationLink}`;
            
            window.open(`https://wa.me/917651837322?text=${message}`, '_blank');
        }
        
        function sendCustomerNotification(status) {
            if (!currentOrder) return;
            
            const messages = {
                'preparing': `üë®‚Äçüç≥ *EasyGo Order Update* üë®‚Äçüç≥%0A%0AYour order #${currentOrder.orderId} is being prepared.%0AEstimated ready time: 15-20 minutes.%0A%0AThank you for choosing EasyGo!`,
                'out-for-delivery': `üõµ *EasyGo Order Update* üõµ%0A%0AYour order #${currentOrder.orderId} is out for delivery!%0ADelivery partner: EasyGo Rider%0AEstimated arrival: 25-30 minutes.%0A%0APlease keep your OTP ready for delivery confirmation.`,
                'delivered': `‚úÖ *EasyGo Order Update* ‚úÖ%0A%0AYour order #${currentOrder.orderId} has been delivered!%0A%0APlease rate your experience:%0Ahttps://www.google.com/maps/place/EasyGo/@22.7767506,75.9581962,17z`
            };
            
            if (messages[status]) {
                window.open(`https://wa.me/${currentOrder.customerPhone}?text=${messages[status]}`, '_blank');
            }
        }
        
        function markAsCancelled() {
            if (!currentOrder) return;
            
            if (confirm('Are you sure you want to cancel this order?')) {
                currentOrder.status = 'cancelled';
                currentOrder.cancelledAt = new Date().toISOString();
                
                // Send cancellation notification to customer
                const cancelMessage = `‚ùå *ORDER CANCELLED* ‚ùå%0A%0A` +
                                    `We're sorry, but your order #${currentOrder.orderId} has been cancelled.%0A%0A` +
                                    `*Refund Information:*%0AYour payment of ‚Çπ${currentOrder.totalAmount} will be refunded within 5 working days.%0A%0A` +
                                    `For any queries, contact: 76518 37322`;
                
                window.open(`https://wa.me/${currentOrder.customerPhone}?text=${cancelMessage}`, '_blank');
                
                // Send to restaurant
                const restaurantMessage = `‚ùå *ORDER CANCELLED* ‚ùå%0A%0A` +
                                        `Order #${currentOrder.orderId} has been cancelled.%0A%0A` +
                                        `*Customer:* ${currentOrder.customerName}%0A` +
                                        `*Phone:* ${currentOrder.customerPhone}%0A` +
                                        `*Amount to Refund:* ‚Çπ${currentOrder.totalAmount}%0A` +
                                        `*Time:* ${new Date().toLocaleTimeString()}`;
                
                window.open(`https://wa.me/917651837322?text=${restaurantMessage}`, '_blank');
                
                // Update localStorage
                const orders = JSON.parse(localStorage.getItem('easygo-active-orders')) || [];
                const index = orders.findIndex(o => o.orderId === currentOrder.orderId);
                if (index > -1) {
                    orders.splice(index, 1);
                    localStorage.setItem('easygo-active-orders', JSON.stringify(orders));
                }
                
                // Add to cancelled orders
                const cancelled = JSON.parse(localStorage.getItem('easygo-cancelled-orders')) || [];
                cancelled.push(currentOrder);
                localStorage.setItem('easygo-cancelled-orders', JSON.stringify(cancelled));
                
                loadActiveOrders();
                alert('Order cancelled and notifications sent.');
            }
        }
        
        function loadOrderHistory() {
            const history = JSON.parse(localStorage.getItem('easygo-order-history')) || [];
            const container = document.getElementById('order-history');
            
            if (history.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No orders in history</p>';
                return;
            }
            
            let html = '';
            history.slice(-10).reverse().forEach(order => {
                html += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">${order.customerName}</p>
                            <p class="text-sm text-gray-600">${new Date(order.deliveredAt).toLocaleTimeString()}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold">‚Çπ${order.totalAmount}</p>
                            <p class="text-sm text-green-600">‚úÖ Delivered</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function callDeliveryPartner() {
            if (currentOrder && currentOrder.deliveryPhone) {
                window.open(`tel:${currentOrder.deliveryPhone}`, '_blank');
            } else {
                window.open('tel:+919876543210', '_blank');
            }
        }
        
        function closeDeliveryModal() {
            document.getElementById('delivery-modal').classList.add('hidden');
            document.getElementById('delivery-otp').value = '';
            document.getElementById('delivery-partner-name').value = '';
        }
        
        function loginAdmin() {
            const pin = document.getElementById('admin-pin').value;
            if (pin === MAJDOOR_PIN) {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('dashboard-section').classList.remove('hidden');
                
                // Load data
                loadActiveOrders();
                loadOrderHistory();
                
                // Update time
                setInterval(() => {
                    document.getElementById('current-time').textContent = new Date().toLocaleTimeString();
                }, 1000);
            } else {
                alert('Invalid PIN');
            }
        }
        
        function logoutAdmin() {
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('dashboard-section').classList.add('hidden');
            document.getElementById('admin-pin').value = '';
        }
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            // Check if already logged in (for demo)
            const isLoggedIn = localStorage.getItem('easygo-admin-logged-in');
            if (isLoggedIn === 'true') {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('dashboard-section').classList.remove('hidden');
                loadActiveOrders();
                loadOrderHistory();
            }
        });
    </script>
</body>
</html>
